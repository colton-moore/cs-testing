<div class="cs-timer" data-start-seconds="180">
  <button class="cs-timer__stopwatch" id="csStopwatchBtn" aria-label="Open timer and start countdown">
    <img class="cs-timer__stopwatch-fill" src="https://s3.amazonaws.com/media-p.slid.es/uploads/team-3032/images/12460410/CS_Slides_Stopwatch_Fill.svg" alt="" draggable="false" />
    <img class="cs-timer__stopwatch-outline" src="https://s3.amazonaws.com/media-p.slid.es/uploads/2912448/images/12460518/Stopwatch-outline-no-number.svg" alt="" draggable="false" />
    <div class="cs-timer__stopwatch-time" id="csStopwatchTime">03:00</div>
  </button>

  <section class="cs-timer__panel" id="csTimerPanel" aria-hidden="true">
    <button class="cs-timer__close-btn" id="csCloseBtn" aria-label="Close timer">✕</button>
    <div class="cs-timer__time" id="csMainTime">03:00</div>
    <div class="cs-timer__controls-row">
      <button class="cs-timer__round-btn" id="csPausePlayBtn" aria-label="Pause timer">
        <span id="csPausePlayIcon" class="cs-icon-pause">❚❚</span>
      </button>
      <button class="cs-timer__pill-btn" id="csAdd30Btn" aria-label="Add 30 seconds">+30 SEC</button>
      <button class="cs-timer__round-btn" id="csResetBtn" aria-label="Reset timer">
        <span class="cs-icon-reset">↻</span>
      </button>
    </div>
  </section>
</div>

<style>
body { margin:0; }
.cs-timer {
  position: fixed;
  top: 1rem;
  right: 1rem;
  font-family: system-ui, sans-serif;
  color: #0b1630;
  user-select: none;
  z-index: 1000;
}
.cs-timer__stopwatch {
  position: relative;
  width: 100px;
  height: 100px;
  border: 0;
  background: none;
  padding: 0;
  cursor: pointer;
  transition: filter .18s, transform .18s;
}
.cs-timer__stopwatch:hover { filter: brightness(1.05); transform: scale(1.02); }
.cs-timer__stopwatch-fill, .cs-timer__stopwatch-outline {
  position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: none;
}
.cs-timer__stopwatch-time {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 1.25rem;
  color: #000;
  line-height: 1;
  pointer-events: none;
  text-align: center;
  min-width: 100%;
}

.cs-timer__panel {
  position: absolute;
  top: 0;
  right: 110px;
  height: 100px;
  min-width: 200px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  background: #f4f9ff;
  border: 2px solid #cdd9ff;
  border-radius: .75rem;
  box-shadow: 0 4px 12px rgba(11,22,48,.06);
  padding: 0.5rem 0.75rem;
  opacity: 0;
  pointer-events: none;
  visibility: hidden;
  transition: opacity .18s, visibility .18s;
}
.cs-timer__panel[aria-hidden="false"] { opacity: 1; visibility: visible; pointer-events: auto; }

.cs-timer__close-btn {
  position: absolute;
  top: -0.75rem;
  left: -0.75rem;
  width: 1.5rem; height: 1.5rem;
  background: #dbe5ff;
  border: 2px solid #cdd9ff;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75rem; color: #0b1630; cursor: pointer;
}

/* Bigger, more dominant time */
.cs-timer__time {
  text-align: center;
  font-size: 2.2rem;
  font-weight: 700;
  color: #000;
  line-height: 1;
  margin-bottom: 0.4rem;
}

.cs-timer__controls-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
}

.cs-timer__round-btn,
.cs-timer__pill-btn {
  background: #dbe5ff;
  border: 2px solid #cdd9ff;
  box-shadow: 0 2px 6px rgba(11,22,48,.06);
  cursor: pointer;
  transition: filter .18s, transform .18s;
  height: 1.5rem;
  line-height: 1;
}

.cs-timer__round-btn {
  width: 1.5rem;
  border-radius: 0.5rem;
  font-size: 0.7rem;
  color: #0b1630;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.cs-timer__pill-btn {
  border-radius: 0.5rem;
  padding: 0 0.4rem;
  font-size: 0.7rem;
  font-weight: 600;
  color: #0b1630;
  white-space: nowrap;
}

.cs-timer__round-btn:hover,
.cs-timer__pill-btn:hover {
  filter: brightness(1.07);
  transform: scale(1.03);
}
</style>

<script>
(function(){
  const root = document.querySelector('.cs-timer');
  const stopwatchBtn = document.getElementById('csStopwatchBtn');
  const panel = document.getElementById('csTimerPanel');
  const closeBtn = document.getElementById('csCloseBtn');
  const mainTimeEl = document.getElementById('csMainTime');
  const stopwatchTimeEl = document.getElementById('csStopwatchTime');
  const pausePlayBtn = document.getElementById('csPausePlayBtn');
  const pausePlayIcon = document.getElementById('csPausePlayIcon');
  const add30Btn = document.getElementById('csAdd30Btn');
  const resetBtn = document.getElementById('csResetBtn');

  const INITIAL_SECONDS = parseInt(root.getAttribute('data-start-seconds') || '180', 10);

  let remaining = INITIAL_SECONDS;
  let running = false;
  let hasEverStarted = false;
  let intervalId = null;

  function formatTime(totalSeconds){
    const mins = Math.floor(totalSeconds / 60);
    const secs = totalSeconds % 60;
    const minsStr = mins < 10 ? '0' + mins : '' + mins;
    const secsStr = secs < 10 ? '0' + secs : '' + secs;
    return minsStr + ':' + secsStr;
  }

  function render(){
    const display = formatTime(Math.max(remaining,0));
    mainTimeEl.textContent = display;
    stopwatchTimeEl.textContent = display;
  }

  function startTimer(){
    if(running) return;
    running = true;
    updatePausePlayIcon();
    intervalId = setInterval(()=>{
      remaining -= 1;
      if(remaining <= 0){
        remaining = 0;
        stopTimer();
      }
      render();
    },1000);
  }

  function stopTimer(){
    running = false;
    updatePausePlayIcon();
    if(intervalId){
      clearInterval(intervalId);
      intervalId = null;
    }
  }

  function updatePausePlayIcon(){
    if(running){
      pausePlayIcon.textContent = '❚❚';
      pausePlayBtn.setAttribute('aria-label','Pause timer');
    } else {
      pausePlayIcon.textContent = '▶';
      pausePlayBtn.setAttribute('aria-label','Play timer');
    }
  }

  function resetTimer(){
    remaining = INITIAL_SECONDS;
    render();
    stopTimer();
  }

  function add30(){
    remaining += 30;
    render();
  }

  function openPanelAndMaybeStart(){
    panel.setAttribute('aria-hidden','false');
    if(!hasEverStarted){
      hasEverStarted = true;
      startTimer();
    }
  }

  function closePanel(){
    panel.setAttribute('aria-hidden','true');
  }

  function togglePanel(){
    const isHidden = panel.getAttribute('aria-hidden') === 'true';
    if(isHidden){
      openPanelAndMaybeStart();
    } else {
      closePanel();
    }
  }

  stopwatchBtn.addEventListener('click', togglePanel);
  closeBtn.addEventListener('click', closePanel);
  pausePlayBtn.addEventListener('click', ()=> running ? stopTimer() : startTimer());
  add30Btn.addEventListener('click', add30);
  resetBtn.addEventListener('click', resetTimer);

  render();
  updatePausePlayIcon();
})();
</script>
