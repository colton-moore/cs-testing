<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timer Chip</title>
  <style>
    :root{
      --chip-bg:#fff;
      --chip-border:#E6E6EA;
      --chip-shadow:0 6px 16px rgba(16,24,40,.08);
      --accent:#B31E2D; /* dark red */
      --accent-light:#FCE6D8; /* light orange */
      --text:#2B2B2B;
      --muted:#8C8C94;
      --digit-bg:#F7F7FA;
      --radius:16px;
    }

    html,body{height:100%;margin:0;background:transparent;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";color:var(--text)}

    /* Layout: chip sits top-right; panel expands from there */
    .wrap{position:relative; width:100%; height:100%; min-height:80px;}

    /* --- Chip (collapsed) --- */
    .chip{position:absolute; top:8px; right:8px; display:flex;align-items:center;gap:.5rem;padding:.375rem .6rem .375rem .375rem;border:1px solid var(--chip-border);border-radius:999px;background:var(--chip-bg);box-shadow:var(--chip-shadow);cursor:pointer;user-select:none;transition:transform .15s ease, box-shadow .2s ease}
    .chip:active{transform:translateY(1px)}

    .chip .icon-wrap{width:26px;height:26px;border-radius:999px;background:var(--accent);display:grid;place-items:center;position:relative}
    .chip img{width:16px;height:16px;display:block;filter:brightness(0) invert(1)}

    .chip .pill{display:inline-flex;align-items:center;font-variant-numeric:tabular-nums;letter-spacing:.5px;padding:.15rem .45rem;border-radius:10px;background:var(--accent-light);border:1px solid var(--accent);color:var(--accent);font-weight:600}

    /* --- Panel (expanded) --- */
    .panel{position:absolute; top:48px; right:8px; width:min(420px,92vw);max-width:420px;border:1px solid var(--chip-border);border-radius:20px;background:#fff;box-shadow:0 20px 50px rgba(16,24,40,.16);padding:1rem;display:none; transform-origin: top right; animation: pop .18s ease}
    .panel.open{display:block}

    @keyframes pop{ from{ transform:scale(.98); opacity:.0 } to{ transform:scale(1); opacity:1 } }

    .panel .head{display:flex;align-items:center;gap:.6rem;margin-bottom:.5rem}
    .panel .head .title{font-size:.95rem;color:var(--muted)}

    .lcd{display:grid;place-items:center;margin:.25rem 0 0.75rem}
    .lcd .screen{font-variant-numeric:tabular-nums;letter-spacing:2px;font-size:3.25rem;line-height:1;background:var(--digit-bg);border-radius:14px;padding:.6rem 1rem;border:1px solid #EDEDF2;box-shadow:inset 0 -2px 0 rgba(0,0,0,.03)}

    .controls{display:flex;align-items:center;gap:.5rem}
    .btn{display:inline-grid;place-items:center;border:none;border-radius:999px;background:var(--accent);color:#fff;width:42px;height:42px;cursor:pointer;transition:transform .12s ease, opacity .2s ease}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:var(--accent-light);color:var(--accent)}

    .ghost{font-size:.85rem;color:var(--muted);margin-left:auto}

    .vh{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <button class="chip" id="chip" aria-expanded="false" aria-controls="timer-panel">
      <span class="icon-wrap" aria-hidden="true">
        <img id="chip-icon" alt="" src="https://s3.amazonaws.com/media-p.slid.es/uploads/2912448/images/12422823/T1-MS-Icon-Speechbubble-OUTLINE.svg" />
      </span>
      <span class="pill"><span class="vh" id="chip-label">Timer:</span><span id="chip-time">02:00</span></span>
    </button>

    <section class="panel" id="timer-panel" aria-hidden="true" role="group" aria-label="2-minute timer">
      <div class="head">
        <span class="icon-wrap" aria-hidden="true" style="background:var(--accent)"><img alt="" src="https://s3.amazonaws.com/media-p.slid.es/uploads/2912448/images/12422823/T1-MS-Icon-Speechbubble-OUTLINE.svg" style="filter:brightness(0) invert(1)"/></span>
        <div class="title" id="panel-title">Discuss — 2 minutes</div>
      </div>

      <div class="lcd"><div class="screen" id="screen">02:00</div></div>

      <div class="controls">
        <button class="btn" id="play" aria-label="Pause timer" title="Pause">
          <!-- Pause by default when opened running -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 5h5v14H6zM13 5h5v14h-5z"/></svg>
        </button>
        <button class="btn secondary" id="reset" aria-label="Reset" title="Reset">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 6V3L8 7l4 4V8a4 4 0 1 1-4 4H6a6 6 0 1 0 6-6Z"/></svg>
        </button>
        <span class="ghost" id="hint">click ▶ to start</span>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const qs = new URLSearchParams(location.search);
      const totalSeconds = (qs.get('sec')? parseInt(qs.get('sec'),10) : (qs.get('min')? Math.round(parseFloat(qs.get('min'))*60) : NaN));
      const secondsDefault = Number.isFinite(totalSeconds) && totalSeconds>0 ? totalSeconds : 120;

      const label = qs.get('label') || 'Discuss';
      const icon = qs.get('icon');

      const chip = document.getElementById('chip');
      const panel = document.getElementById('timer-panel');
      const screen = document.getElementById('screen');
      const play = document.getElementById('play');
      const reset = document.getElementById('reset');
      const chipTime = document.getElementById('chip-time');
      const chipIcon = document.getElementById('chip-icon');
      const title = document.getElementById('panel-title');
      const hint = document.getElementById('hint');

      if(icon){ chipIcon.src = icon; panel.querySelector('.icon-wrap img').src = icon; }
      title.textContent = `${label} — ${Math.floor(secondsDefault/60)} minute${secondsDefault>=120?'s':''}`;

      let remaining = secondsDefault;
      let ticking = null;
      let startedAt = null;

      function fmt(s){
        const m = Math.floor(s/60).toString().padStart(2,'0');
        const sec = Math.floor(s%60).toString().padStart(2,'0');
        return `${m}:${sec}`;
      }
      function render(){
        const t = fmt(remaining);
        screen.textContent = t;
        chipTime.textContent = t;
        document.title = t + ' – Timer';
      }
      render();

      function openPanel(){
        panel.classList.add('open');
        panel.setAttribute('aria-hidden','false');
        chip.setAttribute('aria-expanded','true');
      }
      function closePanel(){
        panel.classList.remove('open');
        panel.setAttribute('aria-hidden','true');
        chip.setAttribute('aria-expanded','false');
      }

      function beep(){
        try{
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
          g.gain.setValueAtTime(0.0001, ctx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.01);
          o.start();
          o.stop(ctx.currentTime+0.25);
        }catch(e){}
      }

      function start(){
        if(ticking) return;
        const now = Date.now();
        startedAt = now - (secondsDefault - remaining)*1000; // resume support
        play.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 5h5v14H6zM13 5h5v14h-5z"/></svg>';
        play.setAttribute('aria-label','Pause');
        hint.textContent='running…';
        ticking = setInterval(()=>{
          const elapsed = Math.floor((Date.now() - startedAt)/1000);
          remaining = Math.max(0, secondsDefault - elapsed);
          render();
          if(remaining<=0){ stop(); beep(); hint.textContent='time!'; }
        }, 250);
      }

      function stop(){
        if(ticking){ clearInterval(ticking); ticking=null; }
        play.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M8 5v14l11-7L8 5Z"/></svg>';
        play.setAttribute('aria-label','Start');
        hint.textContent='paused';
      }

      function hardReset(){ remaining = secondsDefault; render(); stop(); hint.textContent='click ▶ to start'; }

      // Chip behavior: open & auto-start; close pauses
      chip.addEventListener('click', ()=>{
        const isOpen = panel.classList.contains('open');
        if(isOpen){ closePanel(); stop(); }
        else { openPanel(); start(); }
      });

      play.addEventListener('click', ()=> ticking ? stop() : start());
      reset.addEventListener('click', hardReset);

      if(qs.get('open')==='1'){ openPanel(); }
      if(qs.get('auto')==='1'){ openPanel(); start(); }
    })();
  </script>
</body>
</html>