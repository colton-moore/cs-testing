<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timer Chip</title>
  <style>
    :root{
      /* === EASY COLOR KNOBS (edit these) === */
      --accent:#B31E2D;        /* primary accent (dark red) */
      --accent-light:#FCE6D8;  /* light accent (badge/bg) */

      /* --- Usually fine to leave alone --- */
      --chip-border:#E6E6EA;
      --chip-shadow:0 6px 16px rgba(16,24,40,.08);
      --text:#2B2B2B; --muted:#8C8C94; --digit-bg:#F7F7FA;
    }

    html,body{height:100%;margin:0;background:transparent;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";color:var(--text)}
    .wrap{position:relative;width:100%;height:100%;min-height:80px;}

    /* === Bottom-left cluster that keeps chip + close button together === */
    .cluster{position:absolute;bottom:8px;left:8px;display:flex;align-items:center;gap:6px;z-index:10}

    /* === Chip === */
    .chip{display:flex;align-items:center;gap:.5rem;padding:.375rem .6rem;border:1px solid var(--chip-border);border-radius:999px;background:#fff;box-shadow:var(--chip-shadow);cursor:pointer;user-select:none}
    .chip:active{transform:translateY(1px)}
    .chip .icon-wrap{display:grid;place-items:center}
    .chip img{width:22px;height:22px;display:block}
    .chip .pill{display:inline-flex;align-items:center;font-variant-numeric:tabular-nums;letter-spacing:.5px;padding:.15rem .5rem;border-radius:10px;background:var(--accent-light);border:1px solid var(--accent);color:var(--accent);font-weight:600}

    /* === Close (×) — appears only when panel is open === */
    .close-chip{display:none;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;border:1px solid var(--chip-border);background:#fff;box-shadow:var(--chip-shadow);cursor:pointer}
    .close-chip svg{width:14px;height:14px}
    .close-chip.show{display:flex}

    /* === Panel === */
    .panel{position:absolute;bottom:58px;left:8px;display:none;flex-direction:column;align-items:flex-start;gap:.6rem;border:1px solid var(--chip-border);border-radius:16px;background:#fff;box-shadow:0 20px 40px rgba(16,24,40,.14);padding:.85rem 1rem .9rem 1rem;transform-origin:bottom left;animation:pop .18s ease;max-width:fit-content}
    .panel.open{display:flex}
    @keyframes pop{from{transform:scale(.97);opacity:0}to{transform:scale(1);opacity:1}}

    .panel .head{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem}
    .panel .title{font-size:.9rem;color:var(--muted)}

    .lcd{display:flex;align-items:center;margin:.1rem 0 .5rem 0;width:100%}
    .lcd .screen{font-variant-numeric:tabular-nums;letter-spacing:2px;font-size:2.8rem;line-height:1;background:var(--digit-bg);border-radius:10px;padding:.4rem .75rem;border:1px solid #EDEDF2;box-shadow:inset 0 -2px 0 rgba(0,0,0,.03)}

    .controls{display:flex;align-items:center;gap:.4rem;width:100%}
    .btn{display:inline-grid;place-items:center;border:none;border-radius:999px;background:var(--accent);color:#fff;min-width:40px;height:40px;padding:0 .7rem;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:var(--accent-light);color:var(--accent)}
    .btn.text{background:var(--accent-light);color:var(--accent);font-weight:700;border:1px solid var(--accent)}

    .vh{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <!--
      QUICK CUSTOMIZATION GUIDE
      ---------------------------------
      1) JS: Set DEFAULT_MINUTES (e.g., 1, 2, 3). Or pass ?min=1 or ?sec=60.
      2) JS: Replace ICON_URL with any SVG/PNG. Or pass ?icon=<url>.
      3) CSS: Change --accent / --accent-light above for colors. Or use URL ?accent=#hex&accentLight=#hex.
    -->

    <!-- Collapsed chip + close button live together so they "hug" in the corner -->
    <div class="cluster">
      <button class="chip" id="chip" aria-expanded="false" aria-controls="timer-panel">
        <span class="icon-wrap" aria-hidden="true">
          <img id="chip-icon" alt="" />
        </span>
        <span class="pill"><span class="vh" id="chip-label">Timer:</span><span id="chip-time">02:00</span></span>
      </button>
      <button class="close-chip" id="closeChip" aria-label="Close timer panel" title="Close">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6l12 12M18 6L6 18" stroke="#9A9AA3" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>

    <!-- Expanded panel -->
    <section class="panel" id="timer-panel" aria-hidden="true" role="group" aria-label="timer">
      <div class="head">
        <span class="icon-wrap" aria-hidden="true"><img alt="" id="panel-icon"/></span>
        <div class="title" id="panel-title">Discuss — 3 minutes</div>
      </div>
      <div class="lcd"><div class="screen" id="screen">02:00</div></div>
      <div class="controls">
        <button class="btn" id="play" aria-label="Pause timer" title="Pause">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M6 5h5v14H6zM13 5h5v14h-5z"/></svg>
        </button>
        <button class="btn text" id="add1" title="Add 1 minute">+1:00</button>
        <button class="btn secondary" id="reset" title="Reset">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 6V3L8 7l4 4V8a4 4 0 1 1-4 4H6a6 6 0 1 0 6-6Z"/></svg>
        </button>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const qs=new URLSearchParams(location.search);

      /* =====================
         CONFIG — edit here
         ===================== */
      const DEFAULT_MINUTES = 1; // change to 1 or 3 (or pass ?min=1 / ?sec=60)
      const ICON_URL = 'https://s3.amazonaws.com/media-p.slid.es/uploads/2912448/images/12376786/MS-Action.svg'; // swap to any SVG/PNG (or ?icon=...)
      // Optional: override colors via URL like ?accent=%23B31E2D&accentLight=%23FCE6D8
      const accentURL = qs.get('accent');
      const accentLightURL = qs.get('accentLight');
      if(accentURL) document.documentElement.style.setProperty('--accent', accentURL);
      if(accentLightURL) document.documentElement.style.setProperty('--accent-light', accentLightURL);

      // URL overrides for time + label + icon
      const secondsFromURL = qs.get('sec') ? parseInt(qs.get('sec'),10)
                              : (qs.get('min') ? Math.round(parseFloat(qs.get('min'))*60) : NaN);
      const secondsDefault = Number.isFinite(secondsFromURL) && secondsFromURL>0 ? secondsFromURL : DEFAULT_MINUTES*60;
      const iconOverride = qs.get('icon');
      const label = qs.get('label') || 'Discuss';

      // Elements
      const cluster=document.querySelector('.cluster');
      const chip=document.getElementById('chip');
      const closeChip=document.getElementById('closeChip');
      const panel=document.getElementById('timer-panel');
      const screen=document.getElementById('screen');
      const play=document.getElementById('play');
      const reset=document.getElementById('reset');
      const add1=document.getElementById('add1');
      const chipTime=document.getElementById('chip-time');
      const chipIcon=document.getElementById('chip-icon');
      const panelIcon=document.getElementById('panel-icon');
      const title=document.getElementById('panel-title');

      // Set icons
      const ICON = iconOverride || ICON_URL;
      chipIcon.src = ICON; panelIcon.src = ICON;

      title.textContent = `${label} — ${Math.floor(secondsDefault/60)} minute${secondsDefault>=120?'s':''}`;

      // Timer uses a moving deadline so +1:00 works while running
      let remaining = secondsDefault; // seconds
      let ticking = null;            // interval id
      let targetAt = null;           // timestamp (ms) when timer hits 0

      function fmt(s){
        const m = Math.floor(s/60).toString().padStart(2,'0');
        const sec = Math.floor(s%60).toString().padStart(2,'0');
        return `${m}:${sec}`;
      }
      function render(){
        const t = fmt(remaining);
        screen.textContent = t; chipTime.textContent = t; document.title = t + ' – Timer';
      }
      render();

      function openPanel(){
        panel.classList.add('open'); panel.setAttribute('aria-hidden','false'); chip.setAttribute('aria-expanded','true');
        closeChip.classList.add('show');
      }
      function closePanel(){
        panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); chip.setAttribute('aria-expanded','false');
        closeChip.classList.remove('show');
      }

      function beep(){
        try{ const ctx=new(window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain();
             o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
             g.gain.setValueAtTime(0.0001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.3,ctx.currentTime+0.01);
             o.start(); o.stop(ctx.currentTime+0.25); }catch(e){}
      }

      function start(){
        if(ticking) return;
        if(!targetAt) targetAt = Date.now() + remaining*1000; // on first start or after reset
        play.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M6 5h5v14H6zM13 5h5v14h-5z"/></svg>';
        play.setAttribute('aria-label','Pause');
        ticking = setInterval(()=>{
          const now = Date.now();
          remaining = Math.max(0, Math.ceil((targetAt - now)/1000));
          render();
          if(remaining<=0){ stop(); beep(); }
        }, 250);
      }

      function stop(){
        if(ticking){ clearInterval(ticking); ticking=null; }
        play.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7L8 5Z"/></svg>';
        play.setAttribute('aria-label','Start');
      }

      function hardReset(){ stop(); remaining = secondsDefault; targetAt = null; render(); }

      // +1:00 extends even while running; revives from 0
      add1.addEventListener('click', ()=>{
        if(!targetAt){ remaining += 60; render(); }
        else { targetAt += 60*1000; const now = Date.now(); remaining = Math.max(0, Math.ceil((targetAt - now)/1000)); render(); }
        if(remaining<=0){ targetAt = Date.now() + 60*1000; remaining = 60; render(); start(); }
      });

      // Chip toggles panel (auto-start on open). Close button always collapses.
      chip.addEventListener('click', ()=>{
        const isOpen = panel.classList.contains('open');
        if(isOpen){ closePanel(); } else { openPanel(); if(!ticking) start(); }
      });
      closeChip.addEventListener('click', ()=> closePanel());

      play.addEventListener('click', ()=> ticking ? stop() : start());
      reset.addEventListener('click', hardReset);

      // Optional URL flags
      if(qs.get('open')==='1'){ openPanel(); }
      if(qs.get('auto')==='1'){ openPanel(); start(); }
    })();
  </script>
</body>
</html>
